@model IEnumerable<EnglishLearning.Models.Progress>

@{
    ViewData["Title"] = "Quản lý Tiến trình Người dùng";
    Layout = "~/Areas/Admin/Views/Shared/Temp.cshtml";
}

<style>
    .progress-container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .progress-table {
        background: #ffffff;
        border-radius: 8px;
        overflow: hidden;
    }

    .progress-table th {
        background: #007bff;
        color: #ffffff;
        padding: 12px;
        text-align: center;
    }

    .progress-table td {
        padding: 12px;
        text-align: center;
        vertical-align: middle;
    }

    .progress-table tr:nth-child(even) {
        background: #f1f3f5;
    }

    .progress-table tr:hover {
        background: #e9ecef;
        transition: background 0.3s ease;
    }

    .completed {
        color: #28a745;
        font-weight: bold;
    }

    .not-completed {
        color: #dc3545;
        font-weight: bold;
    }

    .date {
        font-size: 0.9rem;
        color: #6c757d;
    }
</style>

<div class="progress-container">
    <h2 class="text-center mb-4" style="color: #007bff;">Quản lý Tiến trình Người dùng</h2>

    <table class="table progress-table">
        <thead>
            <tr>
                <th>Tên Người dùng</th>
                <th>Bài học</th>
                <th>Số điểm</th>
                <th>Trạng thái</th>
                <th>Thời gian Hoàn thành</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var progress in Model)
            {
                <tr>
                    <td>@progress.User?.Username</td>
                    <td>@progress.Lesson?.Title</td>
                    <td>@progress.Score</td>
                    <td>
                        @if (progress.IsCompleted)
                        {
                            <span class="completed">Đã hoàn thành</span>
                        }
                        else
                        {
                            <span class="not-completed">Chưa hoàn thành</span>
                        }
                    </td>
                    <td>
                        @if (progress.CompletedAt.HasValue)
                        {
                            <span class="date">@progress.CompletedAt.Value.ToString("dd/MM/yyyy HH:mm")</span>
                        }
                        else
                        {
                            <span class="date">Chưa hoàn thành</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>

    @if (!Model.Any())
    {
        <p class="text-center text-muted">Không có tiến trình nào để hiển thị.</p>
    }
</div>
@if (Model.Any())
{
    var totalPages = ViewBag.TotalPages as int? ?? 1;
    var currentPage = ViewBag.CurrentPage as int? ?? 1;

    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center flex-wrap">
            <!-- Trang đầu -->
            <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                <a class="page-link" href="?page=1" aria-label="First">
                    <span>««</span>
                </a>
            </li>

            <!-- Trang trước -->
            <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                <a class="page-link" href="?page=@(currentPage - 1)" aria-label="Previous">
                    <span>«</span>
                </a>
            </li>

            @{
                int startPage = Math.Max(1, currentPage - 2);
                int endPage = Math.Min(totalPages, currentPage + 2);

                // Hiển thị trang 1 nếu không nằm trong khoảng
                if (startPage > 1)
                {
                    <li class="page-item"><a class="page-link" href="?page=1">1</a></li>
                    if (startPage > 2)
                    {
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                    }
                }

                // Hiển thị các trang ở giữa
                for (int i = startPage; i <= endPage; i++)
                {
                    <li class="page-item @(i == currentPage ? "active" : "")">
                        <a class="page-link" href="?page=@i">@i</a>
                    </li>
                }

                // Hiển thị trang cuối nếu cần
                if (endPage < totalPages)
                {
                    if (endPage < totalPages - 1)
                    {
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                    }
                    <li class="page-item"><a class="page-link" href="?page=@totalPages">@totalPages</a></li>
                }
            }

            <!-- Trang sau -->
            <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                <a class="page-link" href="?page=@(currentPage + 1)" aria-label="Next">
                    <span>»</span>
                </a>
            </li>

            <!-- Trang cuối -->
            <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                <a class="page-link" href="?page=@totalPages" aria-label="Last">
                    <span>»»</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Thông tin trang -->
    <div class="text-center text-muted small mt-2">
        Trang <strong>@currentPage</strong> / @totalPages
        (@Model.Count() bản ghi trên trang này
        @if (ViewBag.TotalItems > 0)
        {
            <text>| Tổng cộng @ViewBag.TotalItems bản ghi</text>
        })
    </div>
}
else
{
    <p class="text-center text-muted mt-4">Không có tiến trình nào để hiển thị.</p>
}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>